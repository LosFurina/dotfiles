# === Zsh åˆ«åä¸å‡½æ•°é…ç½® ===
# é€‚é… macOSã€Archã€Debian çš„é€šç”¨é…ç½®

# ============================================
# åŸºç¡€å¯¼èˆª
# ============================================

alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'
alias ~='cd ~'
alias -- -='cd -'  # è¿”å›ä¸Šä¸€ä¸ªç›®å½•

alias cls='clear'
alias zshconfig='nvim ~/dotfiles/zsh/.zshrc'
alias zshsource='source ~/.zshrc'
alias zshenv='nvim ~/dotfiles/zsh/.zsh_env'
alias zshalias='nvim ~/dotfiles/zsh/.zsh_aliases'

# ============================================
# å®‰å…¨å¼€å…³
# ============================================

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias ln='ln -i'

# æ›´å®‰å…¨çš„åˆ é™¤ï¼ˆä½¿ç”¨ trash å¦‚æœå¯ç”¨ï¼‰
if command -v trash >/dev/null 2>&1; then
    alias del='trash'
elif command -v gio >/dev/null 2>&1; then
    alias del='gio trash'
else
    alias del='rm -i'
fi

# ============================================
# ç°ä»£å·¥å…·æ›¿ä»£
# ============================================

# Eza (ls æ›¿ä»£)
if command -v eza >/dev/null 2>&1; then
    alias ls='eza --icons --group-directories-first'
    alias ll='eza --icons -l --git --group-directories-first'
    alias la='eza --icons -la --git --group-directories-first'
    alias lt='eza --icons --tree --level=2 --group-directories-first'
    alias lt3='eza --icons --tree --level=3 --group-directories-first'
    alias lsd='eza --icons -lD'  # ä»…æ˜¾ç¤ºç›®å½•
    alias lsf='eza --icons -lf --color=always | grep -v /'  # ä»…æ˜¾ç¤ºæ–‡ä»¶
else
    alias ls='ls --color=auto'
    alias ll='ls -lh'
    alias la='ls -lAh'
fi

# Bat (cat æ›¿ä»£)
if command -v bat >/dev/null 2>&1; then
    alias cat='bat --paging=never'
    alias ccat='bat --style=plain --paging=never'  # çº¯æ–‡æœ¬æ¨¡å¼
    alias bathelp='bat --list-themes'
fi

# Zoxide (cd æ›¿ä»£)
if command -v zoxide >/dev/null 2>&1; then
    alias cd='z'
fi

# ============================================
# Yazi æ–‡ä»¶ç®¡ç†å™¨å¢å¼º
# ============================================

# é€€å‡ºæ—¶è‡ªåŠ¨ cd åˆ°å½“å‰ç›®å½•
function yy() {
    local tmp="$(mktemp -t "yazi-cwd.XXXXXX")"
    yazi "$@" --cwd-file="$tmp"
    if cwd="$(cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
        builtin cd -- "$cwd"
    fi
    rm -f -- "$tmp"
}

# ============================================
# ç¼–è¾‘å™¨åˆ«å
# ============================================

alias vi='nvim'
alias vim='nvim'
alias v='nvim'
alias nv='nvim'

# å¿«é€Ÿç¼–è¾‘é…ç½®æ–‡ä»¶
alias vimconfig='nvim ~/dotfiles/nvim/.config/nvim/init.lua'
alias kittyconfig='nvim ~/dotfiles/kitty/.config/kitty/kitty.conf'
alias gitconfig='nvim ~/dotfiles/git/.gitconfig'
alias tmuxconfig='nvim ~/dotfiles/tmux/.tmux.conf'
alias dotfiles='cd ~/dotfiles && nvim'

# ============================================
# Git å¢å¼ºåˆ«å
# ============================================

alias g='git'
alias gs='git status -sb'
alias ga='git add'
alias gaa='git add --all'
alias gap='git add -p'  # äº¤äº’å¼æ·»åŠ 
alias gc='git commit'
alias gcm='git commit -m'
alias gca='git commit --amend'
alias gcan='git commit --amend --no-edit'

alias gp='git push'
alias gpf='git push --force-with-lease'  # æ›´å®‰å…¨çš„å¼ºåˆ¶æ¨é€
alias gl='git pull'
alias gf='git fetch'

alias gd='git diff'
alias gds='git diff --staged'
alias gdt='git difftool'

alias gco='git checkout'
alias gcb='git checkout -b'
alias gsw='git switch'
alias gswc='git switch -c'

alias gb='git branch'
alias gba='git branch -a'
alias gbd='git branch -d'
alias gbD='git branch -D'

alias gm='git merge'
alias gma='git merge --abort'
alias gr='git rebase'
alias gri='git rebase -i'
alias gra='git rebase --abort'
alias grc='git rebase --continue'

alias gst='git stash'
alias gstp='git stash pop'
alias gstl='git stash list'
alias gsta='git stash apply'

alias glg='git log --graph --oneline --decorate --all'
alias glgs='git log --graph --pretty=format:"%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset" --abbrev-commit'
alias glo='git log --oneline'
alias glast='git log -1 HEAD'

alias gclean='git clean -fd'
alias grh='git reset HEAD'
alias grhh='git reset --hard HEAD'
alias gundo='git reset HEAD~1 --mixed'

# Lazygit
if command -v lazygit >/dev/null 2>&1; then
    alias lg='lazygit'
fi

# ============================================
# Docker å¿«æ·æ–¹å¼
# ============================================

alias d='docker'
alias dc='docker-compose'
alias dps='docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"'
alias dpsa='docker ps -a --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"'
alias dimg='docker images'
alias dex='docker exec -it'
alias dlogs='docker logs -f'
alias dstop='docker stop'
alias drm='docker rm'
alias drmi='docker rmi'
alias dprune='docker system prune -af'
alias dvol='docker volume ls'
alias dnet='docker network ls'

# Docker Compose
alias dcu='docker-compose up -d'
alias dcd='docker-compose down'
alias dcl='docker-compose logs -f'
alias dcr='docker-compose restart'
alias dcb='docker-compose build'

# Lazydocker
if command -v lazydocker >/dev/null 2>&1; then
    alias ld='lazydocker'
fi

# ============================================
# Kubernetes å¿«æ·æ–¹å¼
# ============================================

alias k='kubectl'
alias kgp='kubectl get pods'
alias kgs='kubectl get svc'
alias kgd='kubectl get deploy'
alias kgn='kubectl get nodes'
alias kga='kubectl get all'

alias kdesc='kubectl describe'
alias kdel='kubectl delete'
alias klog='kubectl logs -f'
alias kexec='kubectl exec -it'

alias kctx='kubectl config current-context'
alias kns='kubectl config set-context --current --namespace'

# ============================================
# ç³»ç»Ÿç›‘æ§å·¥å…·
# ============================================

# Bottom (top/htop æ›¿ä»£)
if command -v btm >/dev/null 2>&1; then
    alias top='btm'
    alias htop='btm'
elif command -v htop >/dev/null 2>&1; then
    alias top='htop'
fi

# Procs (ps æ›¿ä»£)
if command -v procs >/dev/null 2>&1; then
    alias ps='procs'
    alias psa='procs --tree'
fi

# Duf (df æ›¿ä»£)
if command -v duf >/dev/null 2>&1; then
    alias df='duf'
fi

# Dust (du æ›¿ä»£)
if command -v dust >/dev/null 2>&1; then
    alias du='dust'
fi

# Fd (find æ›¿ä»£)
if command -v fd >/dev/null 2>&1; then
    alias find='fd'
fi

# ============================================
# ç½‘ç»œå·¥å…·
# ============================================

# HTTPie (curl æ›¿ä»£)
if command -v http >/dev/null 2>&1; then
    alias get='http GET'
    alias post='http POST'
    alias put='http PUT'
    alias delete='http DELETE'
fi

# ç½‘ç»œæµ‹è¯•
alias myip='curl -s https://ipinfo.io/ip'
alias myipinfo='curl -s https://ipinfo.io/json | bat -l json'
alias speedtest='curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python3 -'

# ç«¯å£æ‰«æ
alias ports='netstat -tulanp'
alias listening='lsof -i -P | grep LISTEN'

# ============================================
# Python è™šæ‹Ÿç¯å¢ƒ
# ============================================

alias venv='python3 -m venv venv'
alias activate='source venv/bin/activate'
alias deactivate='deactivate'
alias py='python3'
alias pip='pip3'
alias pipi='pip3 install'
alias pipu='pip3 install --upgrade'
alias pipr='pip3 install -r requirements.txt'

# ============================================
# Node.js / npm / yarn
# ============================================

alias ni='npm install'
alias nid='npm install --save-dev'
alias nig='npm install -g'
alias nr='npm run'
alias ns='npm start'
alias nt='npm test'
alias nb='npm run build'
alias nci='rm -rf node_modules package-lock.json && npm install'

alias yi='yarn install'
alias ya='yarn add'
alias yad='yarn add --dev'
alias yr='yarn run'
alias ys='yarn start'
alias yt='yarn test'
alias yb='yarn build'

# ============================================
# å®ç”¨å‡½æ•°
# ============================================

# åˆ›å»ºç›®å½•å¹¶è¿›å…¥
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# æå–å„ç§å‹ç¼©åŒ…
extract() {
    if [ -f "$1" ]; then
        case "$1" in
            *.tar.bz2)   tar xjf "$1"     ;;
            *.tar.gz)    tar xzf "$1"     ;;
            *.bz2)       bunzip2 "$1"     ;;
            *.rar)       unrar x "$1"     ;;
            *.gz)        gunzip "$1"      ;;
            *.tar)       tar xf "$1"      ;;
            *.tbz2)      tar xjf "$1"     ;;
            *.tgz)       tar xzf "$1"     ;;
            *.zip)       unzip "$1"       ;;
            *.Z)         uncompress "$1"  ;;
            *.7z)        7z x "$1"        ;;
            *)           echo "'$1' æ— æ³•è§£å‹" ;;
        esac
    else
        echo "'$1' ä¸æ˜¯æœ‰æ•ˆçš„æ–‡ä»¶"
    fi
}

# æŸ¥æ‰¾è¿›ç¨‹
psg() {
    ps aux | grep -v grep | grep -i -e VSZ -e "$1"
}

# å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶
ff() {
    if command -v fd >/dev/null 2>&1; then
        fd "$1"
    else
        find . -type f -name "*$1*"
    fi
}

# å¿«é€ŸæŸ¥æ‰¾ç›®å½•
ffd() {
    if command -v fd >/dev/null 2>&1; then
        fd -t d "$1"
    else
        find . -type d -name "*$1*"
    fi
}

# Git ä»“åº“å…‹éš†å¹¶è¿›å…¥
gcl() {
    git clone "$1" && cd "$(basename "$1" .git)"
}

# å¿«é€ŸæœåŠ¡å™¨ï¼ˆPython HTTP Serverï¼‰
serve() {
    local port="${1:-8000}"
    python3 -m http.server "$port"
}

# å¤‡ä»½æ–‡ä»¶
backup() {
    cp "$1"{,.backup-$(date +%Y%m%d-%H%M%S)}
}

# ============================================
# æ¸…ç†å‡½æ•°
# ============================================

# æ¸…ç† Docker
cleanup-docker() {
    echo "æ¸…ç† Docker ç³»ç»Ÿ..."
    docker system prune -af --volumes
    echo "âœ… Docker æ¸…ç†å®Œæˆ"
}

# æ¸…ç† Homebrew (macOS)
cleanup-brew() {
    if command -v brew >/dev/null 2>&1; then
        echo "æ¸…ç† Homebrew..."
        brew cleanup
        brew autoremove
        echo "âœ… Homebrew æ¸…ç†å®Œæˆ"
    fi
}

# æ¸…ç† npm
cleanup-npm() {
    echo "æ¸…ç† npm ç¼“å­˜..."
    npm cache clean --force
    echo "âœ… npm æ¸…ç†å®Œæˆ"
}

# å…¨éƒ¨æ¸…ç†
cleanup-all() {
    cleanup-docker
    cleanup-brew
    cleanup-npm
    echo "ğŸ‰ å…¨éƒ¨æ¸…ç†å®Œæˆï¼"
}

# ============================================
# è¶£å‘³å‘½ä»¤
# ============================================

# æ˜¾ç¤ºå†å²å‘½ä»¤ä½¿ç”¨é¢‘ç‡
alias histop='history | awk "{print \$2}" | sort | uniq -c | sort -rn | head -20'

# å¿«é€Ÿå¤‡å¿˜å½•
note() {
    echo "$(date +'%Y-%m-%d %H:%M:%S'): $*" >> ~/notes.txt
}

viewnotes() {
    if command -v bat >/dev/null 2>&1; then
        bat ~/notes.txt
    else
        cat ~/notes.txt
    fi
}

# ============================================
# Tmux å¿«æ·æ–¹å¼
# ============================================

alias ta='tmux attach -t'
alias tad='tmux attach -d -t'
alias ts='tmux new-session -s'
alias tl='tmux list-sessions'
alias tksv='tmux kill-server'
alias tkss='tmux kill-session -t'
